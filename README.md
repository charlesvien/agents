# ðŸ¤– Charles' Agentic Workflow

The skills and agents I use to ship code for PostHog. Built around Graphite stacked PRs and the PostHog Code ecosystem.

## Setup

```bash
git clone https://github.com/charlesvien/agents
cd agents
./install.sh
```

Symlinks everything into `~/.claude/` alongside your existing skills and agents.

## Skills

| Skill | What it does | When to use |
|---|---|---|
| `/ctrace` | Trace a tRPC call end-to-end | Before touching unfamiliar code paths |
| `/ctest` | Generate colocated tests for a source file | After writing or changing a module |
| `/cwrap` | Parallel typecheck + lint + test, fix all errors | Before committing  - make sure nothing's broken |
| `/crebase` | Rebase onto parent, resolve conflicts | When your stack falls behind |
| `/cpr` | Create a Graphite PR with auto-generated title | Ready to ship  - opens the PR for you |
| `/cscaffold` | Scaffold a new Twig feature | Starting a new feature from scratch |
| `/clogs` | Find Claude/Twig session log files | Debugging a session or task run |
| `/cbatch` | Parallelize a code transformation across many files | Migrations, renames and API changes  - e.g. `/cbatch migrate from trpc to orpc` |

## Agents

| Agent | Model | What it does |
|---|---|---|
| `code-reviewer` | Sonnet | Reviews diffs for bugs, security, performance and TS strictness |
| `refactor` | Sonnet | Analyzes code structure, identifies violations of store/service boundary and applies safe refactors |

## Settings

Copy the parts you want into your own `~/.claude/settings.json` (don't symlink  - it would overwrite your personal config).

```json
{
  "attribution": {
    "commit": "",
    "pr": ""
  },
  "model": "opus",
  "enabledPlugins": {
    "frontend-design@claude-code-plugins": true
  },
  "skipDangerousModePermissionPrompt": true
}
```

| Setting | Value | Why |
|---|---|---|
| `attribution.commit` / `attribution.pr` | `""` (empty) | Disables the "Generated by Claude Code" attribution in commits and PRs. Keeps git history clean. |
| `model` | `"opus"` | Default to the most capable model. Worth the extra cost for complex refactors and multi-file changes |
| `enabledPlugins.frontend-design` | `true` | Enables the `frontend-design` plugin from the official Claude Code marketplace  - produces higher quality UI code with better design sense. |
| `skipDangerousModePermissionPrompt` | `true` | Skips the confirmation dialog when entering dangerously-permissive mode. Removes friction if you trust your setup. |

## CLAUDE.md

The repo includes a global `CLAUDE.md` that gets symlinked to `~/.claude/CLAUDE.md` by the install script. This sets baseline rules for every project. Copy and adapt it if you want your own version.

```markdown
# Global Rules

- **Language**: English only. All code, comments, docs, examples, commits, configs, errors and tests.
- **Style**: Prefer self-documenting code over comments. If you need a comment the code isn't clear enough.
- **Tools**: Use `rg` not `grep`, `fd` not `find`, `bat` not `cat`. `tree` is installed.
- **Inclusive terms**: allowlist/blocklist, primary/replica, placeholder/example, main branch, conflict-free, concurrent/parallel.

## Git

- **Commits**: Conventional format `<type>(<scope>): <subject>`. Types: feat, fix, docs, style, refactor, test, chore, perf. Subject: 50 chars max, imperative mood ("add" not "added"), no period. Single-line only unless I ask otherwise. No attribution.
- **Stacked PRs**: I use Graphite (`gt`). Always diff against the parent branch, not trunk. Use `gt branch info` to find the parent.
- **Atomic commits**: One logical change per commit. Split if addressing different concerns.

## Code

- **Prefer simple over clever**. Write the obvious solution first. Don't abstract until there's a real reason.
- **No barrel files** (index.ts). Import directly from source.
- **No console.log**. Use a scoped logger.
- **TypeScript strict mode**. No `any` casts unless unavoidable.
- **Prefer writing your own solution** over adding a package when the fix is simple.
- **Biome** for linting and formatting, not ESLint/Prettier.
- **pnpm** for package management. Monorepos use pnpm workspaces + turbo.

## Workflow

- Run checks in parallel when possible (typecheck, lint, test are independent).
- Don't push unless I say to. Don't create PRs unless I say to.
- When I say "commit this" just do it. Don't ask for confirmation.
```
